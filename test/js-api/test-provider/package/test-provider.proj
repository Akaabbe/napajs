<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="14.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(EnvironmentConfig)" />

  <!-- These targets must be built before the package -->
  <ItemGroup>
    <QCustomProjectReference Include="..\src\test-provider.vcxproj" />
    <QCustomProjectReference Include="..\napa\addon.vcxproj" />
    <QCustomProjectReference Include="..\node\addon.vcxproj" />
  </ItemGroup>
  
  <PropertyGroup>
    <PackageOutPath>$(IntermediateOutputPath)\node_modules\test-provider</PackageOutPath>
  </PropertyGroup>
  
  <Target Name="CreateNpmPackage" AfterTargets="AfterBuild">
    <Message Text="Create NPM package." />

    <!-- Setup package root directory -->
    <Copy SourceFiles="..\package.json" DestinationFolder="$(PackageOutPath)" ContinueOnError="false" SkipUnchangedFiles="true" />

    <!-- Setup ./bin directory-->
    <!-- Binplace napa binaries -->
    <Copy SourceFiles="..\src\$(IntermediateOutputPath)\test-provider.dll" DestinationFolder="$(PackageOutPath)\bin" ContinueOnError="false" SkipUnchangedFiles="true" />
    <Copy SourceFiles="..\napa\$(IntermediateOutputPath)\addon.napa" DestinationFolder="$(PackageOutPath)\bin" ContinueOnError="false" SkipUnchangedFiles="true" />
    <Copy SourceFiles="..\node\$(IntermediateOutputPath)\addon.node" DestinationFolder="$(PackageOutPath)\bin" ContinueOnError="false" SkipUnchangedFiles="true" />
  </Target>

  <Import Project="$(ExtendedTargetsPath)\NoTarget.targets" />
</Project>
